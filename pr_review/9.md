# PR #9 Review: í…”ë ˆê·¸ë¨ ë´‡ ë‹¤êµ­ì–´(i18n) ì§€ì›

## ê°œìš”

- **ë³€ê²½ íŒŒì¼**: 2ê°œ ìˆ˜ì • (`src/services/mod.rs`, `src/services/telegram.rs`) + 3ê°œ ì‹ ê·œ (`src/services/i18n/mod.rs`, `src/services/i18n/ko.rs`, `src/services/i18n/en.rs`)
- **ë³€ê²½ ì„±ê²©**: ë´‡ UI ë©”ì‹œì§€ì˜ í•œêµ­ì–´/ì˜ì–´ ë‹¤êµ­ì–´ ì§€ì› ì‹œìŠ¤í…œ ë„ì…
- **PR base ê¸°ì¤€**: telegram.rs 2753ì¤„ (í˜„ì¬ main: 4222ì¤„ â€” ì•½ 1469ì¤„ ì°¨ì´)
- **ì ìš© ê°€ëŠ¥ ì—¬ë¶€**: ì§ì ‘ ì ìš© ë¶ˆê°€ â€” ì•„ì´ë””ì–´ëŠ” ì±„íƒí•˜ë˜ í˜„ì¬ main ê¸°ì¤€ìœ¼ë¡œ ë³„ë„ êµ¬í˜„ í•„ìš”

---

## PRì˜ ëª©ì 

í…”ë ˆê·¸ë¨ ë´‡ì´ ì¶œë ¥í•˜ëŠ” **ê³ ì • UI ë©”ì‹œì§€(ìº¡ì…˜)**ë¥¼ í•œêµ­ì–´/ì˜ì–´ë¡œ ì „í™˜í•  ìˆ˜ ìˆëŠ” i18n ì‹œìŠ¤í…œì„ ë„ì…í•œë‹¤.

- ì±„íŒ…ë³„ë¡œ ì–¸ì–´ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŒ (`/lang ko`, `/lang en`)
- AI(Claude)ì˜ ì‘ë‹µ ì–¸ì–´ì—ëŠ” ì˜í–¥ ì—†ìŒ â€” ìˆœìˆ˜í•˜ê²Œ ë´‡ ìì²´ ë©”ì‹œì§€ë§Œ ëŒ€ìƒ
- ê¸°ë³¸ ì–¸ì–´ëŠ” í•œêµ­ì–´(Ko)

---

## ë³€ê²½ ë‚´ìš© ìƒì„¸

### ë³€ê²½ 1: i18n ëª¨ë“ˆ ì‹ ê·œ ìƒì„±

**ìœ„ì¹˜**: `src/services/i18n/` (ìƒˆ ë””ë ‰í† ë¦¬)

#### `src/services/i18n/mod.rs` (227ì¤„)

i18n ì‹œìŠ¤í…œì˜ í•µì‹¬ ëª¨ë“ˆ. `Lang` enumê³¼ ê° ë©”ì‹œì§€ì— ëŒ€í•œ ë””ìŠ¤íŒ¨ì¹˜ í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤.

```rust
#[derive(Clone, Copy, Debug, PartialEq)]
pub enum Lang {
    Ko,
    En,
}

impl Default for Lang {
    fn default() -> Self {
        Lang::Ko  // ê¸°ë³¸ ì–¸ì–´: í•œêµ­ì–´
    }
}

pub fn resolve_lang(code: &str) -> Lang {
    match code.to_lowercase().as_str() {
        "en" => Lang::En,
        _ => Lang::Ko,
    }
}
```

ê° ë©”ì‹œì§€ì— ëŒ€í•´ `Lang`ì— ë”°ë¼ ko/en ëª¨ë“ˆì˜ ìƒìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë“¤ì„ ì œê³µí•œë‹¤:

| í•¨ìˆ˜ëª… | ë°˜í™˜ íƒ€ì… | ìš©ë„ |
|--------|-----------|------|
| `msg_no_session(lang)` | `&'static str` | ì„¸ì…˜ ì—†ìŒ ì•ˆë‚´ |
| `msg_session_cleared(lang)` | `&'static str` | ì„¸ì…˜ ì´ˆê¸°í™” ì™„ë£Œ |
| `msg_ai_busy(lang)` | `&'static str` | AI ìš”ì²­ ì§„í–‰ ì¤‘ |
| `msg_permission_denied(lang)` | `&'static str` | ê¶Œí•œ ì—†ìŒ |
| `msg_stopping(lang)` | `&'static str` | ì¤‘ë‹¨ ì¤‘ |
| `msg_no_active_request(lang)` | `&'static str` | ì¤‘ë‹¨í•  ìš”ì²­ ì—†ìŒ |
| `msg_group_only(lang)` | `&'static str` | ê·¸ë£¹ ì „ìš© ì»¤ë§¨ë“œ |
| `msg_public_owner_only(lang)` | `&'static str` | ì†Œìœ ì ì „ìš© |
| `msg_public_enabled(lang)` | `&'static str` | Public ì ‘ê·¼ í™œì„±í™” |
| `msg_public_disabled(lang)` | `&'static str` | Public ì ‘ê·¼ ë¹„í™œì„±í™” |
| `msg_public_status(lang, status)` | `String` | Public ìƒíƒœ í‘œì‹œ (í…œí”Œë¦¿) |
| `msg_public_status_label(lang, bool)` | `&'static str` | "í™œì„±í™”ë¨"/"ë¹„í™œì„±í™”ë¨" |
| `msg_public_usage(lang)` | `&'static str` | /public ì‚¬ìš©ë²• |
| `msg_lang_changed(lang)` | `&'static str` | ì–¸ì–´ ë³€ê²½ ì™„ë£Œ |
| `msg_lang_usage(lang)` | `&'static str` | /lang ì‚¬ìš©ë²• |
| `msg_shell_usage(lang)` | `&'static str` | ! ì…¸ ëª…ë ¹ ì‚¬ìš©ë²• |
| `msg_shell_timeout(lang)` | `&'static str` | ì…¸ íƒ€ì„ì•„ì›ƒ |
| `msg_shell_processing(lang, cmd)` | `String` | ì…¸ ì²˜ë¦¬ì¤‘ (í…œí”Œë¦¿) |
| `msg_down_usage(lang)` | `&'static str` | /down ì‚¬ìš©ë²• |
| `msg_down_no_session(lang)` | `&'static str` | ë‹¤ìš´ë¡œë“œ ì‹œ ì„¸ì…˜ ì—†ìŒ |
| `msg_file_save_failed(lang, err)` | `String` | íŒŒì¼ ì €ì¥ ì‹¤íŒ¨ (í…œí”Œë¦¿) |
| `msg_sandbox_denied(lang)` | `&'static str` | ìƒŒë“œë°•ìŠ¤ ë°– ê²½ë¡œ ê±°ë¶€ |
| `msg_error_home(lang)` | `&'static str` | í™ˆ ë””ë ‰í† ë¦¬ ì˜¤ë¥˜ |
| `msg_error_invalid_dir(lang, dir)` | `String` | ìœ íš¨í•˜ì§€ ì•Šì€ ë””ë ‰í† ë¦¬ (í…œí”Œë¦¿) |
| `msg_error_create_workspace(lang, err)` | `String` | ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹¤íŒ¨ (í…œí”Œë¦¿) |
| `help_text(lang)` | `&'static str` | /help ì „ì²´ ë„ì›€ë§ |

#### `src/services/i18n/ko.rs` (108ì¤„)

í•œêµ­ì–´ ë¬¸ìì—´ ìƒìˆ˜ ëª¨ë“ˆ. ëª¨ë“  ìƒìˆ˜ê°€ `pub(super)`ë¡œ ì„ ì–¸ë˜ì–´ `mod.rs`ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥.

ì£¼ìš” ë‚´ìš© ì˜ˆì‹œ:
```rust
pub(super) const MSG_NO_SESSION: &str = "í™œì„± ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. /start <ê²½ë¡œ> ë¡œ ì‹œì‘í•˜ì„¸ìš”.";
pub(super) const MSG_SESSION_CLEARED: &str = "ì„¸ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
pub(super) const MSG_STOPPING: &str = "ì¤‘ë‹¨ ì¤‘...";
pub(super) const MSG_SHELL_PROCESSING: &str = "{}ì— ëŒ€í•´ì„œ ì²˜ë¦¬ì¤‘ì…ë‹ˆë‹¤.";
```

`help_text()` í•¨ìˆ˜ëŠ” í•œêµ­ì–´ ë„ì›€ë§ HTML ì „ë¬¸ì„ ë°˜í™˜í•œë‹¤ (ì„¸ì…˜, íŒŒì¼ ì „ì†¡, ì…¸, AI ëŒ€í™”, ë„êµ¬ ê´€ë¦¬, ê·¸ë£¹ ì±„íŒ…, ì–¸ì–´, ì„¤ì • ì„¹ì…˜ í¬í•¨).

#### `src/services/i18n/en.rs` (115ì¤„)

ì˜ì–´ ë¬¸ìì—´ ìƒìˆ˜ ëª¨ë“ˆ. ko.rsì™€ ë™ì¼í•œ êµ¬ì¡°.

```rust
pub(super) const MSG_NO_SESSION: &str = "No active session. Use /start <path> first.";
pub(super) const MSG_SESSION_CLEARED: &str = "Session cleared.";
pub(super) const MSG_STOPPING: &str = "Stopping...";
pub(super) const MSG_SHELL_PROCESSING: &str = "Processing !{}...";
```

### ë³€ê²½ 2: `src/services/mod.rs`ì— ëª¨ë“ˆ ë“±ë¡

```diff
 pub mod file_ops;
+pub mod i18n;
 pub mod process;
 pub mod claude;
 pub mod remote;
```

### ë³€ê²½ 3: `BotSettings` êµ¬ì¡°ì²´ì— `chat_language` í•„ë“œ ì¶”ê°€

```rust
struct BotSettings {
    allowed_tools: HashMap<String, Vec<String>>,
    last_sessions: HashMap<String, String>,
    owner_user_id: Option<u64>,
    as_public_for_group_chat: HashMap<String, bool>,
+   /// chat_id (string) â†’ language code ("ko" or "en")
+   chat_language: HashMap<String, String>,
}
```

`Default` implì—ë„ `chat_language: HashMap::new()` ì¶”ê°€.

### ë³€ê²½ 4: `get_chat_lang()` í—¬í¼ í•¨ìˆ˜ ì¶”ê°€

```rust
fn get_chat_lang(settings: &BotSettings, chat_id: ChatId) -> Lang {
    let key = chat_id.0.to_string();
    settings.chat_language.get(&key)
        .map(|code| resolve_lang(code))
        .unwrap_or_default()  // ê¸°ë³¸ê°’: Ko
}
```

### ë³€ê²½ 5: `load_bot_settings()` / `save_bot_settings()`ì— `chat_language` íŒŒì‹±/ì €ì¥ ì¶”ê°€

**load**:
```rust
let chat_language: HashMap<String, String> = entry.get("chat_language")
    .and_then(|v| v.as_object())
    .map(|obj| {
        obj.iter()
            .filter_map(|(k, v)| v.as_str().map(|s| (k.clone(), s.to_string())))
            .collect()
    })
    .unwrap_or_default();
```

**save**:
```rust
"chat_language": settings.chat_language,
```

### ë³€ê²½ 6: `/lang` ì»¤ë§¨ë“œ í•¸ë“¤ëŸ¬ ì¶”ê°€

ì»¤ë§¨ë“œ ë””ìŠ¤íŒ¨ì¹˜ ì²´ì¸ì— `/lang` ë¶„ê¸° ì¶”ê°€:
```rust
} else if text.starts_with("/lang") {
    handle_lang_command(&bot, chat_id, &text, &state, token).await?;
}
```

`handle_lang_command` í•¨ìˆ˜:
```rust
async fn handle_lang_command(
    bot: &Bot, chat_id: ChatId, text: &str, state: &SharedState, token: &str,
) -> ResponseResult<()> {
    let arg = text.strip_prefix("/lang").unwrap_or("").trim().to_lowercase();
    let (lang, response) = if arg == "ko" || arg == "en" {
        let new_lang = resolve_lang(&arg);
        {
            let mut data = state.lock().await;
            data.settings.chat_language.insert(chat_id.0.to_string(), arg.clone());
            save_bot_settings(token, &data.settings);
        }
        (new_lang, i18n::msg_lang_changed(new_lang).to_string())
    } else {
        let lang = { let d = state.lock().await; get_chat_lang(&d.settings, chat_id) };
        (lang, i18n::msg_lang_usage(lang).to_string())
    };
    // HTML íŒŒì‹± ëª¨ë“œë¡œ ì „ì†¡
}
```

### ë³€ê²½ 7: ê° í•¸ë“¤ëŸ¬ì˜ í•˜ë“œì½”ë”© ë¬¸ìì—´ì„ i18n í•¨ìˆ˜ í˜¸ì¶œë¡œ êµì²´

PRì´ êµì²´í•œ ë¬¸ìì—´ ëª©ë¡ (PR base ê¸°ì¤€, ì•½ 20ê°œì†Œ):

| í•¸ë“¤ëŸ¬ | ì›ë³¸ (í•˜ë“œì½”ë”©) | êµì²´ í›„ (i18n) |
|--------|-----------------|----------------|
| `handle_help_command` | ì˜ì–´ ë„ì›€ë§ HTML ì „ë¬¸ (45ì¤„) | `i18n::help_text(lang)` |
| `handle_start_command` | `"Error: cannot determine home directory."` | `i18n::msg_error_home(lang)` |
| `handle_start_command` | `format!("Error: failed to create workspace: {}", e)` | `i18n::msg_error_create_workspace(lang, &e.to_string())` |
| `handle_start_command` | `format!("Error: '{}' is not a valid directory.", expanded)` | `i18n::msg_error_invalid_dir(lang, &expanded)` |
| `handle_clear_command` | `"Session cleared."` | `i18n::msg_session_cleared(lang)` |
| `handle_pwd_command` | `"No active session. Use /start <path> first."` | `i18n::msg_no_session(lang)` |
| `handle_stop_command` | `"Stopping..."` | `i18n::msg_stopping(lang)` |
| `handle_stop_command` | `"No active request to stop."` | `i18n::msg_no_active_request(lang)` |
| `handle_down_command` | `"Usage: /down <filepath>\nExample: ..."` | `i18n::msg_down_usage(lang)` |
| `handle_down_command` | `"No active session. Use absolute path or ..."` | `i18n::msg_down_no_session(lang)` |
| `handle_file_upload` | `"No active session. Use /start <path> first."` | `i18n::msg_no_session(lang)` |
| `handle_file_upload` | `format!("Failed to save file: {}", e)` | `i18n::msg_file_save_failed(lang, &e.to_string())` |
| `handle_shell_command` | `"Usage: !<command>\nExample: ..."` | `i18n::msg_shell_usage(lang)` |
| `handle_shell_command` | `format!("!{}ì— ëŒ€í•´ì„œ ì²˜ë¦¬ì¤‘ì…ë‹ˆë‹¤.", &cmd_display)` | `i18n::msg_shell_processing(lang, &cmd_display)` |
| `handle_public_command` | `"This command is only available in group chats."` | `i18n::msg_group_only(lang)` |
| `handle_public_command` | `"Only the bot owner can change ..."` | `i18n::msg_public_owner_only(lang)` |
| `handle_public_command` | `"âœ… Public access <b>enabled</b> ..."` | `i18n::msg_public_enabled(lang)` |
| `handle_public_command` | `"âŒ Public access <b>disabled</b> ..."` | `i18n::msg_public_disabled(lang)` |
| `handle_public_command` | Public ìƒíƒœ í‘œì‹œ format ë¬¸ìì—´ | `i18n::msg_public_status(lang, ...)` + `i18n::msg_public_status_label(lang, is_public)` |
| `handle_public_command` | Public ì‚¬ìš©ë²• ë¬¸ìì—´ | `i18n::msg_public_usage(lang)` |
| `handle_text_message` | `"No active session. Use /start <path> first."` | `i18n::msg_no_session(lang)` |

ê° í•¸ë“¤ëŸ¬ ì§„ì…ë¶€ì—ì„œ `let lang = { let d = state.lock().await; get_chat_lang(&d.settings, chat_id) };` íŒ¨í„´ìœ¼ë¡œ í˜„ì¬ ì±„íŒ…ì˜ ì–¸ì–´ë¥¼ ì¡°íšŒí•œë‹¤.

---

## í˜„ì¬ Mainê³¼ì˜ êµ¬ì¡°ì  ì°¨ì´

### Mainì— ì¶”ê°€ëœ ì£¼ìš” ê¸°ëŠ¥ (PRì´ ì•Œì§€ ëª»í•˜ëŠ” ê²ƒë“¤)

| í•­ëª© | ì„¤ëª… |
|------|------|
| `BotSettings.models` | ì±„íŒ…ë³„ AI ëª¨ë¸ ì„¤ì • (`HashMap<String, String>`) |
| `BotSettings.debug` | ë””ë²„ê·¸ ë¡œê¹… í† ê¸€ ì˜ì†í™” (`bool`) |
| `ChatSession`ì— `#[derive(Clone)]` | ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ì‹œ ì„¸ì…˜ ë³µì‚¬ í•„ìš” |
| `get_model()` í•¨ìˆ˜ | ì±„íŒ…ë³„ ì„¤ì •ëœ ëª¨ë¸ ì¡°íšŒ |
| `build_system_prompt()` í•¨ìˆ˜ | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬ |
| `check_latest_version()` / `version_is_newer()` | GitHubì—ì„œ ìµœì‹  ë²„ì „ í™•ì¸ |
| `/model` ì»¤ë§¨ë“œ | `handle_model_command()` + `resolve_model_name()` + `display_model_name()` |
| ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì¬ê°œ | `handle_workspace_resume()` + `is_workspace_id()` + `build_history_preview()` |
| ìŠ¤ì¼€ì¤„ ì‹œìŠ¤í…œ | `ScheduleEntry`, `scheduler_loop()`, `execute_schedule()` ë“± ~500ì¤„ |
| cokacdir ëª…ë ¹ í¬ë§·íŒ… | `detect_cokacdir_command()`, `format_cokacdir_result()`, `format_bash_command()` |
| `run_bot` ì‹œì‘ ì¸ì‚¬ | ì•Œë ¤ì§„ ì±„íŒ…ì— ì‹œì‘ ë©”ì‹œì§€ ì „ì†¡ + ë²„ì „ ì—…ë°ì´íŠ¸ ì•Œë¦¼ |
| `save_bot_settings` ì›ìì  ì“°ê¸° | tmp íŒŒì¼ â†’ rename ë°©ì‹ìœ¼ë¡œ ë³€ê²½ |
| `handle_debug_command` ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ | 3ì¸ì â†’ 4ì¸ì (`token` ì¶”ê°€, ë””ë²„ê·¸ ìƒíƒœ ì˜ì†í™”) |
| `handle_clear_command` í™•ì¥ | ì„¸ì…˜ íŒŒì¼ ë””ìŠ¤í¬ì—ì„œ ì‚­ì œ + ê²½ë¡œ í‘œì‹œ |
| `handle_shell_command` ë©”ì‹œì§€ ë³€ê²½ | í•œêµ­ì–´ `"ì²˜ë¦¬ì¤‘ì…ë‹ˆë‹¤"` â†’ ì˜ì–´ `"Processing <code>{}</code>"` |

---

## ì¶©ëŒ ì§€ì  ë¶„ì„

### ì§ì ‘ ì¶©ëŒ (ê°™ì€ ì½”ë“œ ì˜ì—­ì„ ì–‘ìª½ì´ ìˆ˜ì •)

#### 1. `BotSettings` êµ¬ì¡°ì²´
- **PR**: `chat_language: HashMap<String, String>` ì¶”ê°€
- **Main**: `models: HashMap<String, String>`, `debug: bool` ì¶”ê°€
- **í•´ê²°**: ì„¸ í•„ë“œ ëª¨ë‘ í¬í•¨ í•„ìš”

#### 2. `BotSettings::default()` impl
- **PR**: `chat_language: HashMap::new()` ì¶”ê°€
- **Main**: `models: HashMap::new()`, `debug: false` ì¶”ê°€
- **í•´ê²°**: ëª¨ë‘ í¬í•¨

#### 3. `load_bot_settings()`
- **PR**: `chat_language` JSON íŒŒì‹± ì¶”ê°€
- **Main**: `models`, `debug` íŒŒì‹± ì¶”ê°€
- **í•´ê²°**: ì„¸ í•„ë“œ ëª¨ë‘ íŒŒì‹±, return ë¬¸ì— ëª¨ë‘ í¬í•¨

#### 4. `save_bot_settings()`
- **PR**: `"chat_language": settings.chat_language` ì¶”ê°€ (ì§ì ‘ ì“°ê¸°)
- **Main**: `"models"`, `"debug"` ì¶”ê°€ + ì›ìì  ì“°ê¸°(tmp+rename) ë°©ì‹ ë„ì…
- **í•´ê²°**: Mainì˜ ì›ìì  ì“°ê¸° ìœ ì§€, `chat_language` í•„ë“œ ì¶”ê°€

#### 5. ì»¤ë§¨ë“œ ë””ìŠ¤íŒ¨ì¹˜ (if-else ì²´ì¸)
- **PR**: `/setpollingtime`ê³¼ `/debug` ì‚¬ì´ì— `/lang` ì¶”ê°€
- **Main**: `/model` ì»¤ë§¨ë“œ ì¶”ê°€, ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ID í•¸ë“¤ëŸ¬ ì¶”ê°€
- **í•´ê²°**: `/lang`, `/model`, ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ID ëª¨ë‘ í¬í•¨

#### 6. `handle_debug_command` ì‹œê·¸ë‹ˆì²˜
- **PR base**: `handle_debug_command(&bot, chat_id, &state)` (3ì¸ì)
- **Main**: `handle_debug_command(&bot, chat_id, &state, token)` (4ì¸ì)
- **í•´ê²°**: Mainì˜ 4ì¸ì ë²„ì „ ì‚¬ìš©

#### 7. `handle_help_command`
- **PR**: `i18n::help_text(lang)` í˜¸ì¶œ (ë„ì›€ë§ ë‚´ìš©ì€ ko.rs/en.rsì— ì •ì˜)
- **Main**: ë„ì›€ë§ì— `Schedule`, `/model`, `/debug` ì„¹ì…˜ ì¶”ê°€ë¨
- **í•´ê²°**: ko.rs/en.rsì˜ help_textë¥¼ Mainì˜ í˜„ì¬ ë„ì›€ë§ ë‚´ìš©ì— ë§ì¶° ì¬ì‘ì„± í•„ìš”

#### 8. `handle_clear_command`
- **PR**: `i18n::msg_session_cleared(lang)` ì‚¬ìš©
- **Main**: ì„¸ì…˜ íŒŒì¼ ì‚­ì œ ë¡œì§ ì¶”ê°€, `format!("Session cleared.\n\`{}\`", path)` í‘œì‹œ
- **í•´ê²°**: Mainì˜ ë¡œì§ ìœ ì§€, ë©”ì‹œì§€ë¥¼ i18nìœ¼ë¡œ êµì²´ (ìƒˆ í…œí”Œë¦¿ í•¨ìˆ˜ í•„ìš”)

#### 9. `handle_text_message`
- **PR**: `lang` ì¡°íšŒ + `i18n::msg_no_session(lang)` ì‚¬ìš©
- **Main**: `model` ì¡°íšŒ ì¶”ê°€, `build_system_prompt()` ì‚¬ìš©, cokacdir ëª…ë ¹ ì²˜ë¦¬ ì¶”ê°€
- **í•´ê²°**: Mainì˜ êµ¬ì¡° ìœ ì§€, `lang` ì¡°íšŒì™€ i18n ë©”ì‹œì§€ ì ìš©

---

## í˜„ì¬ Mainì—ì„œ i18n ì ìš©ì´ í•„ìš”í•œ ì „ì²´ í•˜ë“œì½”ë”© ë¬¸ìì—´ ëª©ë¡

PRì´ ì»¤ë²„í•œ ì•½ 20ê°œ ì™¸ì—, Mainì—ë§Œ ì¡´ì¬í•˜ëŠ” ì•½ 60ê°œì˜ ì¶”ê°€ ë¬¸ìì—´ì´ ìˆë‹¤.

### run_bot (ì‹œì‘ ë©”ì‹œì§€)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 457 | `"ğŸ†• v{} available â€” https://cokacdir.cokac.com/"` | format! |
| 743 | `"ğŸŸ¢ cokacdir started (v{})\nğŸ“‚ Resuming session at {}"` | format! |

### handle_message (AI ìš”ì²­ ì°¨ë‹¨)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 866 | `"AI request in progress. Use /stop to cancel."` | static |
| 942 | `"AI request in progress. Use /stop to cancel."` | static |

### handle_help_command (ë„ì›€ë§ ì „ë¬¸)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1017-1064 | ì˜ì–´ HTML ë„ì›€ë§ ì „ë¬¸ (Session, File Transfer, Shell, AI Chat, Tool Management, Group Chat, Schedule, Settings ì„¹ì…˜ í¬í•¨) | static (multi-line) |

### handle_start_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1089 | `"Error: cannot determine home directory."` | static |
| 1103 | `format!("Error: failed to create workspace: {}", e)` | format! |
| 1123 | `format!("Error: '{}' is not a valid directory.", expanded)` | format! |
| 1154 | `format!("Session restored at \`{}\`.", canonical_path)` | format! |
| 1157 | `format!("Use /{} to resume this session.", folder_name)` | format! |
| 1174 | `format!("Session started at \`{}\`.", canonical_path)` | format! |
| 1178 | `format!("Use /{} to resume this session.", folder_name)` | format! |

### handle_workspace_resume (Mainì—ë§Œ ì¡´ì¬)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1252 | `"Error: cannot determine home directory."` | static |
| 1260 | `format!("Error: no workspace found for '{}'.", workspace_id)` | format! |
| 1290 | `format!("Session restored at \`{}\`.", canonical_path)` | format! |
| 1307 | `format!("Session started at \`{}\`.", canonical_path)` | format! |

### handle_clear_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1381 | `format!("Session cleared.\n\`{}\`", path)` | format! |
| 1382 | `"Session cleared."` | static |

### handle_pwd_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1409 | `format!("\nUse /{} to switch back to this session.", folder_name)` | format! |
| 1414 | `"No active session. Use /start <path> first."` | static |

### handle_stop_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1440 | `"Stopping..."` | static |
| 1467 | `"No active request to stop."` | static |

### handle_down_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1486 | `"Usage: /down <filepath>\nExample: /down /home/kst/file.txt"` | static |
| 1503 | `"No active session. Use absolute path or /start <path> first."` | static |
| 1513 | `format!("File not found: {}", resolved_path)` | format! |
| 1518 | `format!("Not a file: {}", resolved_path)` | format! |

### handle_file_upload

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1544 | `"No active session. Use /start <path> first."` | static |
| 1574 | `format!("Download failed: {}", e)` | format! |
| 1580 | `format!("Download failed: {}", e)` | format! |
| 1593 | `format!("Saved: {}\n({} bytes)", dest.display(), file_size)` | format! |
| 1599 | `format!("Failed to save file: {}", e)` | format! |

### handle_shell_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1642 | `"Usage: !<command>\nExample: !mkdir /home/kst/testcode"` | static |
| 1662 | `format!("Processing <code>{}</code>", ...)` | format! (HTML) |
| 1842 | `format!("Done <code>{}</code> (exit code: {})\n\n<pre>$ {}\n\n{}</pre>", ...)` | format! (HTML) |
| 1850 | `format!("Done {} (exit code: {})\n\n$ {}\n\n{}", ...)` | format! (plain fallback) |
| 1857 | `format!("Done <code>{}</code> (exit code: {})", ...)` | format! (HTML, ê¸´ ì¶œë ¥) |
| 1875 | `format!("Done <code>{}</code> (exit code: {})", ...)` | format! (HTML, ì¶œë ¥ ì—†ìŒ) |
| 1905 | `"[Stopped]"` | static |

### handle_availabletools_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1951 | `"<b>Available Tools</b>\n\n"` | static (HTML) |
| 1961 | `"\n{} = destructive\nTotal: {}"` | format! |

### handle_allowedtools_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 1979 | `"<b>Allowed Tools</b>\n\n"` | static (HTML) |
| 1989 | `"\n{} = destructive\nTotal: {}"` | format! |

### handle_setpollingtime_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 2014 | `format!("Current polling time: {}ms\nUsage: /setpollingtime <ms>\nMinimum: 2500ms")` | format! |
| 2023 | `"Invalid number. Usage: /setpollingtime <ms>\nExample: /setpollingtime 3000"` | static |
| 2031 | `"Minimum polling time is 2500ms."` | static |
| 2049 | `format!("âœ… Polling time set to {}ms", value)` | format! |

### handle_debug_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 2073 | `format!("ğŸ” Debug logging: {status}")` | format! |

### handle_allowed_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 2094 | `"Usage:\n/allowed +toolname â€” Add a tool\n/allowed -toolname â€” Remove a tool\n/allowed +tool1 -tool2 â€” Multiple at once\n/allowedtools â€” Show current list"` | static |
| 2123 | `"Use +toolname to add or -toolname to remove.\nExample: /allowed +Bash -Edit"` | static |
| 2143 | `format!("<code>{}</code> already in list", ...)` | format! (HTML) |
| 2147 | `format!("âœ… <code>{}</code>", ...)` | format! (HTML, ë„êµ¬ ì¶”ê°€) |
| 2155 | `format!("âŒ <code>{}</code>", ...)` | format! (HTML, ë„êµ¬ ì œê±°) |
| 2157 | `format!("<code>{}</code> not in list", ...)` | format! (HTML) |

### handle_public_command

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 2189 | `"This command is only available in group chats."` | static |
| 2196 | `"Only the bot owner can change public access settings."` | static |
| 2209 | `"âœ… Public access <b>enabled</b> for this group.\nAll members can now use the bot."` | static (HTML) |
| 2215 | `"âŒ Public access <b>disabled</b> for this group.\nOnly the owner can use the bot."` | static (HTML) |
| 2221-2226 | `format!("Public access is currently <b>{}</b> for this group.\n\n<code>/public on</code> â€” ...\n<code>/public off</code> â€” ...")` | format! (HTML) |
| 2229 | `"Usage:\n<code>/public on</code> â€” Allow all group members\n<code>/public off</code> â€” Owner only"` | static (HTML) |

### handle_model_command (Mainì—ë§Œ ì¡´ì¬)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 2273 | `format!("Current model: <b>{}</b>", ...)` | format! (HTML) |
| 2274 | `"Current model: <b>default</b>"` | static (HTML) |
| 2291 | `"Model reset to <b>default</b>."` | static (HTML) |
| 2307 | `format!("Model set to <b>{display}</b>.")` | format! (HTML) |
| 2313-2321 | `"Unknown model. Available:\n<code>/model sonnet</code>\n..."` (7ì¤„) | static (HTML) |

### handle_text_message (AI ìŠ¤íŠ¸ë¦¬ë°)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 2361 | `"No active session. Use /start <path> first."` | static |
| 2373 | `"..."` (AI ì²˜ë¦¬ ì¤‘ í”Œë ˆì´ìŠ¤í™€ë”) | static |
| 2560-2561 | `"(empty)"` (stdout/stderr ë¹ˆ ê²½ìš° í‘œì‹œ) | static |
| 2564 | `"(unknown)"` (exit code ì—†ëŠ” ê²½ìš°) | static |
| 2566-2568 | `format!("Error: {}\n```\nexit code: {}\n\n[stdout]\n{}\n\n[stderr]\n{}\n```")` | format! |
| 2627 | `"(No response)"` | static |
| 2722 | `"[Stopped]"` | static |
| 2725 | `format!("{}\n\n[Stopped]", ...)` | format! |

### format_cokacdir_result (Mainì—ë§Œ ì¡´ì¬)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 3364 | `format!("âŒ {}", msg)` | format! (ì—ëŸ¬) |
| 3370 | `format!("ğŸ• {}", ...)` | format! (ì‹œê°„ í‘œì‹œ) |
| 3377 | `format!("âœ… Scheduled [{}]\nğŸ”– {}\nğŸ“ {}\nğŸ• \`{}\`")` | format! (ìŠ¤ì¼€ì¤„ ìƒì„±) |
| 3382 | `"ğŸ“‹ No schedules found."` | static |
| 3384 | `format!("ğŸ“‹ {} schedule(s)", ...)` | format! |
| 3394 | `format!("\n{}. {}\n   ğŸ• \`{}\`\n   ğŸ”– {}")` | format! (ìŠ¤ì¼€ì¤„ í•­ëª©) |
| 3403 | `format!("âœ… Removed\nğŸ”– {}")` | format! (ìŠ¤ì¼€ì¤„ ì‚­ì œ) |
| 3408 | `format!("âœ… Updated\nğŸ• \`{}\`\nğŸ”– {}")` | format! (ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸) |
| 3412 | `format!("ğŸ“ {}", ...)` | format! (sendfile ê²°ê³¼) |

### execute_schedule (Mainì—ë§Œ ì¡´ì¬)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 3720 | `format!("â° {user_prompt}")` | format! (ìŠ¤ì¼€ì¤„ ì‹œì‘ í”Œë ˆì´ìŠ¤í™€ë”) |
| 3917-3918 | `"(empty)"` | static (stdout/stderr) |
| 3921 | `"(unknown)"` | static (exit code) |
| 3925-3928 | `format!("Error: {}\n```\nexit code: ...\n[stdout]\n...\n[stderr]\n...\n```")` | format! |
| 3949 | `format!("â° {}\n\n{}", prompt, spinner)` | format! |
| 3953 | `format!("â° {}\n\n{}\n\n{}", prompt, response, spinner)` | format! |
| 3988 | `format!("â° {}\n\nâ›” Stopped\n\nUse /{} to continue this schedule session.")` | format! |
| 3994-3995 | `"(No response)"` | static |
| 3998 | `format!("â° {}\n\n{}\n\nUse /{} to continue this schedule session.")` | format! |

### scheduler_loop (Mainì—ë§Œ ì¡´ì¬)

| ì¤„ | ë¬¸ìì—´ | íƒ€ì… |
|----|--------|------|
| 4137-4138 | `format!("â° {}\n\nâš ï¸ Skipped â€” path no longer exists\nğŸ“‚ <code>{}</code>")` | format! (HTML) |

### ì¤‘ë³µ ë“±ì¥ ë¬¸ìì—´ (ë™ì¼ ë¬¸ìì—´ì´ ì—¬ëŸ¬ ê³³ì— ì‚¬ìš©)

| ë¬¸ìì—´ | ë“±ì¥ ìœ„ì¹˜ |
|--------|-----------|
| `"No active session. Use /start <path> first."` | 1414, 1544, 2361 |
| `"Error: cannot determine home directory."` | 1089, 1252 |
| `"Session restored at \`{}\`."` | 1154, 1290 |
| `"Session started at \`{}\`."` | 1174, 1307 |
| `"AI request in progress. Use /stop to cancel."` | 866, 942 |
| `"(No response)"` | 2627, 3994-3995 |
| `"[Stopped]"` | 1905, 2722 |
| `"(empty)"` | 2560, 2561, 3917, 3918 |
| `"(unknown)"` | 2564, 3921 |

---

## PRì´ ì»¤ë²„í•˜ì§€ ëª»í•œ ë¬¸ìì—´ (PR afterì—ë„ í•˜ë“œì½”ë”© ìœ ì§€)

PRì˜ after ë²„ì „ì—ì„œë„ ë‹¤ìŒ ë¬¸ìì—´ë“¤ì€ i18n ì²˜ë¦¬ë˜ì§€ ì•Šì•˜ë‹¤:

1. `"File not found: {}"` (handle_down_command)
2. `"Not a file: {}"` (handle_down_command)
3. `"Download failed: {}"` (handle_file_upload, 2ê³³)
4. `"Saved: {}\n({} bytes)"` (handle_file_upload)
5. `"AI request in progress. Use /stop to cancel."` (handle_message, 2ê³³)
6. ì…¸ ì™„ë£Œ ë©”ì‹œì§€ë“¤ (`"Done ..."` ë³€í˜•, í´ë§ ë£¨í”„ ì•ˆ)
7. `"[Stopped]"` (ì…¸ ì·¨ì†Œ)
8. ë„êµ¬ ê´€ë¦¬ ê´€ë ¨ ë¬¸ìì—´ ì „ì²´ (availabletools, allowedtools, allowed)
9. setpollingtime ê´€ë ¨ ë¬¸ìì—´ ì „ì²´
10. debug ê´€ë ¨ ë¬¸ìì—´

---

## ì ìš© ì „ëµ ê²°ë¡ 

### ì™œ ì§ì ‘ ì ìš©ì´ ë¶ˆê°€í•œê°€

1. **êµ¬ì¡°ì  ê´´ë¦¬**: PRì˜ base ì½”ë“œ(2753ì¤„)ì™€ í˜„ì¬ Main(4222ì¤„) ì‚¬ì´ì— ì•½ 1500ì¤„ì˜ ì°¨ì´. `BotSettings`, `load/save_bot_settings`, ì»¤ë§¨ë“œ ë””ìŠ¤íŒ¨ì¹˜, ì—¬ëŸ¬ í•¸ë“¤ëŸ¬ì˜ ì‹œê·¸ë‹ˆì²˜ì™€ ë¡œì§ì´ ëª¨ë‘ ë‹¤ë¦„.
2. **ì¶©ëŒ ë°€ë„**: 9ê°œì˜ ì§ì ‘ ì¶©ëŒ ì§€ì ì´ ì¡´ì¬í•˜ë©°, ê°ê° ì–‘ìª½ì˜ ë³€ê²½ì„ ì´í•´í•˜ê³  ìˆ˜ë™ìœ¼ë¡œ ë³‘í•©í•´ì•¼ í•¨.
3. **ë¯¸ì™„ì„± ì»¤ë²„ë¦¬ì§€**: PRì€ ì•½ 20ê°œ ë¬¸ìì—´ë§Œ i18ní™”í–ˆìœ¼ë‚˜, í˜„ì¬ Mainì—ëŠ” ì´ ì•½ 80ê°œì˜ í•˜ë“œì½”ë”© ë¬¸ìì—´ì´ ì¡´ì¬. Mainì—ë§Œ ìˆëŠ” ìƒˆ ê¸°ëŠ¥(model, workspace, schedule, cokacdir formatting)ì˜ ~40ê°œ ë¬¸ìì—´ì€ PRì´ ì „í˜€ ëª¨ë¦„.

### ê¶Œì¥ ì ‘ê·¼ë²•: í˜„ì¬ Main ê¸°ì¤€ ë³„ë„ êµ¬í˜„

PRì˜ ì•„ì´ë””ì–´(i18n ì•„í‚¤í…ì²˜, `/lang` ì»¤ë§¨ë“œ, ì±„íŒ…ë³„ ì–¸ì–´ ì„¤ì •)ë¥¼ ì±„íƒí•˜ë˜, í˜„ì¬ Main ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œ ì‘ì—…í•˜ëŠ” ê²ƒì´ ì •í™•í•˜ê³  íš¨ìœ¨ì ì´ë‹¤.

ì‘ì—… ì‹œ ì°¸ê³ ì‚¬í•­:
- i18n ëª¨ë“ˆ êµ¬ì¡° (`mod.rs` + `ko.rs` + `en.rs`)ëŠ” ê·¸ëŒ€ë¡œ í™œìš© ê°€ëŠ¥
- `Lang` enum, `resolve_lang()`, `get_chat_lang()` íŒ¨í„´ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥
- `BotSettings`ì— `chat_language` í•„ë“œ ì¶”ê°€ ì‹œ ê¸°ì¡´ `models`, `debug`ì™€ ê³µì¡´í•˜ë„ë¡ í•´ì•¼ í•¨
- `load/save_bot_settings`ëŠ” Mainì˜ ì›ìì  ì“°ê¸° ë°©ì‹ì„ ìœ ì§€í•˜ë©´ì„œ `chat_language` ì¶”ê°€
- í˜„ì¬ Mainì˜ ë„ì›€ë§ ë‚´ìš©(Schedule, /model, /debug ì„¹ì…˜ í¬í•¨)ì— ë§ì¶° ko.rs/en.rsì˜ help_text ì¬ì‘ì„± í•„ìš”
- Mainì—ë§Œ ìˆëŠ” ìƒˆ í•¸ë“¤ëŸ¬ë“¤(model, workspace resume, schedule ê´€ë ¨)ì˜ ë¬¸ìì—´ë„ i18n ì²˜ë¦¬ ëŒ€ìƒì— í¬í•¨í•´ì•¼ í•¨
